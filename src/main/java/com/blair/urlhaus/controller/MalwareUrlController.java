package com.blair.urlhaus.controller;

import com.blair.urlhaus.domain.MalwareUrl;
import com.blair.urlhaus.domain.MalwareUrlDistance;
import com.blair.urlhaus.service.MalwareUrlService;
import io.swagger.v3.oas.annotations.OpenAPIDefinition;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.info.Info;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import io.swagger.v3.oas.annotations.responses.ApiResponses;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RestController
@RequestMapping("/malware-urls/v1")
@OpenAPIDefinition(
        info = @Info(
                title = "Malware Url API",
                description = "API for searching for \"sketchy\" websites delivering nefarious content, limited to online threats",
                version = "1"
        )
)
public class MalwareUrlController {
    private MalwareUrlService malwareUrlService;

    public MalwareUrlController(MalwareUrlService malwareUrlService) {
        this.malwareUrlService = malwareUrlService;
    }

    @GetMapping
    @Operation(
            description = "Standard endpoint to iterate through all urls",
            parameters = {
                    @Parameter(
                            name = "page",
                            description = "Page of data to retrieve starting at 0"
                    ),
                    @Parameter(
                            name = "size",
                            description = "Number or results to return in the response"
                    )
            }
    )
    @ApiResponses(
            @ApiResponse(
                    description = "Successful retrieval of data",
                    responseCode = "200"
            )
    )
    public List<MalwareUrl> get(
            @RequestParam(value = "page", defaultValue = "0") int page,
            @RequestParam(value = "size", defaultValue = "20") int size
    ) {
        return malwareUrlService.get(page, size);
    }

    @GetMapping("/tag")
    @Operation(
            description = "Endpoint to find all URLs that have the specified tag",
            parameters = {
                    @Parameter(
                            name = "page",
                            description = "Page of data to retrieve starting at 0"
                    ),
                    @Parameter(
                            name = "size",
                            description = "Number or results to return in the response. Default is 20."
                    ),
                    @Parameter(
                            name = "tag",
                            description = "Tag to search for"
                    )
            }
    )
    @ApiResponses(
            @ApiResponse(
                    description = "Successful retrieval of data",
                    responseCode = "200"
            )
    )
    public List<MalwareUrl> searchByTag(
            @RequestParam(value = "page", defaultValue = "0") int page,
            @RequestParam(value = "size", defaultValue = "20") int size,
            @RequestParam("tag") String tag
    ) {
        return malwareUrlService.searchByTag(tag, page, size);
    }

    @GetMapping("/nearest-neighbors")
    @Operation(
            description = "Endpoint to find the closet URLs to the provided latitude and longitude",
            parameters = {
                    @Parameter(
                            name = "page",
                            description = "Page of data to retrieve starting at 0"
                    ),
                    @Parameter(
                            name = "size",
                            description = "Number or results to return in the response. Default is 20."
                    ),
                    @Parameter(
                            name = "longitude",
                            description = "Longitude position"
                    ),
                    @Parameter(
                            name = "latitude",
                            description = "Latitude position"
                    )
            }
    )
    @ApiResponses(
            @ApiResponse(
                    description = "Successful retrieval of data",
                    responseCode = "200"
            )
    )
    public List<MalwareUrlDistance> findNearestNeighbors(
            @RequestParam(value = "page", defaultValue = "0") int page,
            @RequestParam(value = "size", defaultValue = "20") int size,
            @RequestParam("longitude") Double longitude,
            @RequestParam("latitude") Double latitude
    ) {
        return malwareUrlService.findNearestNeighbors(longitude, latitude, page, size);
    }
}
